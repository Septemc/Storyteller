<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Storyteller | 角色</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="assets/js/theme-init.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body data-page="characters">
  <header class="top-nav">
    <div class="nav-left">
      <span class="app-title">Storyteller</span>
      <span class="app-subtitle">说书人·角色管理</span>
    </div>
    <nav class="nav-links">
      <a href="index.html" class="nav-link">剧情</a>
      <a href="characters.html" class="nav-link active">角色</a>
      <a href="worldbook.html" class="nav-link">世界书</a>
      <a href="dungeon.html" class="nav-link">副本</a>
      <a href="settings.html" class="nav-link">设置</a>
    </nav>
  </header>

  <main class="two-column-layout">
    <section class="left-panel">
      <div class="panel-header">
        <div class="panel-title">角色管理</div>
      </div>

      <div class="settings-section" style="padding-bottom: 12px; border-bottom: 1px solid var(--border-soft); margin-bottom: 10px;">
        <label class="form-label">管理角色模板</label>
        <div style="display: flex; gap: 5px; margin-bottom: 8px;">
            <select id="template-select" class="form-select" style="flex: 1;"></select>
            <button id="tpl-apply-btn" class="btn-small btn-primary" title="将此模板应用到当前角色">应用</button>
            <button id="template-import-btn" class="btn-small btn-secondary" title="从文件导入json格式的模板">导入</button>
            <button id="tpl-export-btn" class="btn-small btn-secondary">导出</button>
            <button id="tpl-delete-btn" class="btn-small btn-secondary" style="color:var(--danger)" title="删除此模板">删除</button>

        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <button id="tpl-edit-btn" class="btn-small btn-secondary">编辑选中模板</button>
            <button id="tpl-new-btn" class="btn-small btn-secondary">新建角色模板</button>
            <input type="file" id="template-import-file" accept=".json" style="display: none;">
<!--            <button id="template-import-btn" class="btn-small btn-secondary" style="grid-column: span 2;">从文件导入模板 (.json)</button>-->
        </div>
      </div>

      <div class="settings-section" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
        <div class="search-wrapper" style="position: relative; margin-bottom: 10px;">
          <input id="character-search" class="form-input" placeholder="搜索 ID 或名称..." style="padding-right: 32px;">
          <button id="btn-character-search" class="icon-button" style="position: absolute; right: 6px; top: 50%; transform: translateY(-50%);">
            🔍
          </button>
        </div>

        <div style="display: flex; gap: 4px; align-items: center; margin-bottom: 10px;">
          <input type="file" id="character-import-file" accept=".json" style="display: none;">
          <button id="character-import-btn" class="btn-secondary btn-small" style="flex: 1;" title="导入角色 JSON">导入</button>
          <button id="character-export-all-btn" class="btn-secondary btn-small" style="flex: 1;" title="批量导出角色">导出</button>
          <button id="character-new-btn" class="btn-primary btn-small" style="flex: 1;" title="创建新角色">新建</button>
          <button id="character-delete-all-btn" class="btn-secondary btn-small" style="color: var(--danger); flex: 1;" title="删除全部角色">清空</button>
        </div>

        <div class="character-list-scroll-area" style="flex: 1; overflow-y: auto; border: 1px solid var(--border-soft); border-radius: var(--radius-sm); background: rgba(0,0,0,0.1);">
          <ul id="character-list" class="list" style="margin-top: 0;"></ul>
        </div>
      </div>

    </section>

    <section class="right-panel">
      <div class="panel-header">
        <div class="panel-title" id="right-panel-title">角色详情</div>
        <div class="panel-header-right">
            <button id="character-export-single-btn" class="btn-small btn-secondary">导出当前角色</button>
            <button id="character-delete-btn" class="btn-small btn-secondary" style="color: var(--danger); margin-right: 10px;">删除角色</button>
            <div class="toggle-group" style="display: inline-flex; border: 1px solid var(--border-soft); border-radius: 4px; margin-right: 10px; overflow: hidden;">
                <button id="view-mode-btn" class="btn-small active">预览</button>
                <button id="edit-mode-btn" class="btn-small">编辑</button>
            </div>
            <button id="character-save-btn" class="btn-primary">保存角色</button>
            <span id="character-status" class="small-text" style="margin-left: 10px;"></span>
        </div>
      </div>

      <div id="character-renderer" class="detail-panel rendered-view">
        <div class="placeholder-text" style="color: var(--text-secondary); padding: 20px;">请从左侧列表选择角色...</div>
      </div>

      <div id="character-editor" class="detail-panel" style="display: none;">
        <div class="settings-section half-grid">
          <div>
            <label class="form-label">角色编号 (ID)</label>
            <input id="f-char-id" class="form-input" placeholder="例如 NPC_001">
          </div>
          <div>
            <label class="form-label">角色类型</label>
            <select id="f-char-type" class="form-select">
              <option value="npc">NPC</option>
              <option value="protagonist">主角</option>
              <option value="major">重要角色</option>
            </select>
          </div>
        </div>
        <hr style="border: 0; border-top: 1px solid var(--border-soft); margin: 15px 0;">
        <div id="editor-tabs-nav" class="character-tabs"></div>
        <div id="editor-fields-container" style="margin-top: 10px;"></div>
      </div>
    </section>
  </main>

  <div id="template-designer-modal" class="modal-overlay" style="display: none;">
    <div class="modal-window">
      <div class="modal-header">
        <div style="display: flex; gap: 15px; align-items: center;">
          <span class="panel-title" style="color: var(--accent);">角色模板设计器</span>
          <input id="design-tpl-id" class="form-input" style="width: 140px;" placeholder="模板唯一ID">
          <input id="design-tpl-name" class="form-input" style="width: 200px;" placeholder="显示名称">
        </div>
        <div class="modal-header-right">
          <button id="save-template-btn" class="btn-primary">保存模板配置</button>
          <button id="close-designer-btn" class="btn-secondary">关闭</button>
        </div>
      </div>

      <div class="modal-body" style="display: grid; grid-template-columns: 280px 1fr; gap: 20px; padding: 0;">
        <div style="border-right: 1px solid var(--border-soft); padding: 20px; background: rgba(0,0,0,0.1);">
          <div class="section-inline-header" style="margin-bottom: 15px;">
            <span class="form-label" style="font-weight: bold;">1. 标签页 (Tabs)</span>
            <button id="design-add-tab-btn" class="btn-small-inline btn-secondary">+ 添加新标签</button>
          </div>
          <div id="design-tabs-container" style="display: flex; flex-direction: column; gap: 8px;"></div>
        </div>

        <div style="padding: 20px; overflow-y: auto;">
          <div class="section-inline-header" style="margin-bottom: 15px;">
            <span class="form-label" style="font-weight: bold;">2. 字段配置 (Fields)</span>
            <button id="design-add-field-btn" class="btn-small btn-secondary">+ 添加新字段</button>
          </div>
          <div id="design-fields-container" style="display: flex; flex-direction: column; gap: 12px;">
            </div>
        </div>
      </div>
    </div>
  </div>

  <script src="assets/js/characters.js"></script>
</body>
</html>