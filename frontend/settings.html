<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Storyteller | è®¾ç½®</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="assets/js/theme-init.js"></script>
  <style>
    /* å†…è”è¡¥å……æ ·å¼ï¼Œç”¨äºä¸»é¢˜é¢œè‰²é¢„è§ˆå— */
    .preview-dark { background: #05060a; }
    .preview-light { background: #f0f2f5; }
    .preview-cyberpunk { background: linear-gradient(135deg, #000 0%, #0a0a0e 100%); border: 1px solid #0ff; }
    .preview-scroll { background: #e6dcc3; }
    .preview-forest { background: #0b1410; }
    .preview-abyss { background: #0a0000; border: 1px solid #f00; }
    .preview-royal { background: #120a21; border: 1px solid #ffd700; }

    .preview-bg-grid { background-image: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px); background-size: 10px 10px; }
    .preview-bg-noise { background-color: #222; opacity: 0.8; }
    .preview-bg-plain { background-color: #222; }
    .preview-bg-runes { background: radial-gradient(circle, #444 0%, #222 100%); }
    .preview-bg-circuit { background-image: radial-gradient(#444 20%, transparent 20%); background-size: 5px 5px; }
  </style>
</head>
<body data-page="settings">

  <header class="top-nav">
    <div class="nav-left">
      <span class="app-title">Storyteller</span>
      <span class="app-subtitle">è¯´ä¹¦äººÂ·è®¾ç½®</span>
    </div>
    <nav class="nav-links">
      <a href="index.html" class="nav-link">å‰§æƒ…</a>
      <a href="characters.html" class="nav-link">è§’è‰²</a>
      <a href="worldbook.html" class="nav-link">ä¸–ç•Œä¹¦</a>
      <a href="dungeon.html" class="nav-link">å‰¯æœ¬</a>
      <a href="settings.html" class="nav-link active">è®¾ç½®</a>
    </nav>
  </header>

  <main class="settings-container">

    <aside class="settings-sidebar">
      <button class="settings-tab-btn active" data-target="tab-ui">
        <span class="icon">ğŸ¨</span> ç•Œé¢ä¸æ˜¾ç¤º
      </button>
      <button class="settings-tab-btn" data-target="tab-memory">
        <span class="icon">ğŸ§ </span> æ‘˜è¦ä¸è®°å¿†
      </button>
      <button class="settings-tab-btn" data-target="tab-variables">
        <span class="icon">ğŸ’¡</span> å˜é‡æ€è€ƒ
      </button>
      <button class="settings-tab-btn" data-target="tab-evolution">
        <span class="icon">ğŸŒ</span> æ­£æ–‡ä¸æ¼”åŒ–
      </button>
      <button class="settings-tab-btn" data-target="tab-presets">
        <span class="icon">ğŸ§©</span> é¢„è®¾ç®¡ç†
      </button>
      <button class="settings-tab-btn" data-target="tab-api">
        <span class="icon">ğŸ”Œ</span> APIé…ç½®
      </button>
    </aside>

    <section class="settings-content-area">

      <div class="settings-header-actions">
        <span id="settings-status" class="small-text muted">å°±ç»ª</span>
        <button id="settings-load-btn" class="btn-secondary btn-small">é‡ç½®/åŠ è½½</button>
        <button id="settings-save-btn" class="btn-primary btn-small">ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
      </div>

      <div id="tab-ui" class="tab-pane active">
        <h2 class="section-title">ä¸»é¢˜é£æ ¼ (Theme)</h2>
        <div class="visual-grid" id="theme-grid">
          <div class="visual-option" data-value="dark">
            <div class="color-preview preview-dark"></div>
            <div class="option-label">æ·±ç©º (é»˜è®¤)</div>
          </div>
          <div class="visual-option" data-value="light">
            <div class="color-preview preview-light"></div>
            <div class="option-label">æ™¨æ›¦</div>
          </div>
          <div class="visual-option" data-value="cyberpunk">
            <div class="color-preview preview-cyberpunk"></div>
            <div class="option-label">èµ›åšéœ“è™¹</div>
          </div>
          <div class="visual-option" data-value="scroll">
            <div class="color-preview preview-scroll"></div>
            <div class="option-label">ç¾Šçš®å·</div>
          </div>
          <div class="visual-option" data-value="forest">
            <div class="color-preview preview-forest"></div>
            <div class="option-label">è¿·é›¾æ£®æ—</div>
          </div>
          <div class="visual-option" data-value="abyss">
            <div class="color-preview preview-abyss"></div>
            <div class="option-label">çŒ©çº¢æ·±æ¸Š</div>
          </div>
          <div class="visual-option" data-value="royal">
            <div class="color-preview preview-royal"></div>
            <div class="option-label">çš‡å®¶ç´«é‡‘</div>
          </div>
        </div>

        <h2 class="section-title">èƒŒæ™¯çº¹ç† (Background)</h2>
        <div class="visual-grid" id="bg-grid">
          <div class="visual-option" data-value="grid">
            <div class="color-preview preview-bg-grid"></div>
            <div class="option-label">å…¨æ¯ç½‘æ ¼</div>
          </div>
          <div class="visual-option" data-value="noise">
            <div class="color-preview preview-bg-noise"></div>
            <div class="option-label">èƒ¶ç‰‡å™ªç‚¹</div>
          </div>
          <div class="visual-option" data-value="plain">
            <div class="color-preview preview-bg-plain"></div>
            <div class="option-label">çº¯å‡€è™šç©º</div>
          </div>
          <div class="visual-option" data-value="runes">
            <div class="color-preview preview-bg-runes"></div>
            <div class="option-label">é­”æ³•åŠ›åœº</div>
          </div>
          <div class="visual-option" data-value="circuit">
            <div class="color-preview preview-bg-circuit"></div>
            <div class="option-label">é›†æˆç”µè·¯</div>
          </div>
        </div>

        <h2 class="section-title">å­—ä½“ä¸å­—å· (Typography)</h2>
        <div class="settings-section typography-section">
          <div class="typography-grid">
            <div class="typography-row typography-row--header">
              <div class="typography-col typography-col-label">åŒºåŸŸ</div>
              <div class="typography-col">å­—ä½“æ ·å¼</div>
              <div class="typography-col">å­—ä½“å¤§å°</div>
            </div>

            <div class="typography-row">
              <div class="typography-col typography-col-label">ç³»ç»Ÿç•Œé¢</div>
              <div class="typography-col">
                <select id="font-ui-family" class="form-select">
                  <option value="system-ui, -apple-system, 'Segoe UI', sans-serif">ç³»ç»Ÿæ— è¡¬çº¿ï¼ˆé»˜è®¤ï¼‰</option>
                  <option value="'Noto Serif SC','Songti SC','SimSun',serif">ä¹¦å·è¡¬çº¿</option>
                  <option value="'PingFang SC','Hiragino Sans GB','Microsoft YaHei',sans-serif">ä¸­æ–‡å°åˆ·ä½“</option>
                  <option value="'JetBrains Mono','SF Mono','Consolas',monospace">ç­‰å®½æ‰“å­—æœº</option>
                  <option value="'LXGW WenKai','STKaiti','KaiTi',serif">æ‰‹å†™æ¥·ä½“</option>
                </select>
              </div>
              <div class="typography-col">
                <select id="font-ui-size" class="form-select">
                  <option value="12px">12px</option>
                  <option value="13px">13px</option>
                  <option value="14px">14pxï¼ˆé»˜è®¤ï¼‰</option>
                  <option value="15px">15px</option>
                  <option value="16px">16px</option>
                  <option value="18px">18px</option>
                  <option value="20px">20px</option>
                </select>
              </div>
            </div>

            <div class="typography-row">
              <div class="typography-col typography-col-label">å‰§æƒ…æ­£æ–‡</div>
              <div class="typography-col">
                <select id="font-story-family" class="form-select">
                  <option value="system-ui, -apple-system, 'Segoe UI', sans-serif">ç³»ç»Ÿæ— è¡¬çº¿</option>
                  <option value="'Noto Serif SC','Songti SC','SimSun',serif">ä¹¦å·è¡¬çº¿</option>
                  <option value="'PingFang SC','Hiragino Sans GB','Microsoft YaHei',sans-serif">ä¸­æ–‡å°åˆ·ä½“</option>
                  <option value="'JetBrains Mono','SF Mono','Consolas',monospace">ç­‰å®½æ‰“å­—æœº</option>
                  <option value="'LXGW WenKai','STKaiti','KaiTi',serif">æ‰‹å†™æ¥·ä½“</option>
                </select>
              </div>
              <div class="typography-col">
                <select id="font-story-size" class="form-select">
                  <option value="12px">12px</option>
                  <option value="13px">13px</option>
                  <option value="14px">14px</option>
                  <option value="15px">15px</option>
                  <option value="16px">16px</option>
                  <option value="18px">18px</option>
                  <option value="20px">20px</option>
                </select>
              </div>
            </div>

            </div>
          <div class="small-text muted" style="margin-top:6px;">
            æç¤ºï¼šä¸Šæ–¹è®¾ç½®ä»…å½±å“å­—ä½“æ ·å¼å’ŒåŸºç¡€å­—å·ï¼Œä¸æ”¹å˜é¢œè‰²ä¸è¡Œè·ã€‚
          </div>
        </div>

        <div class="settings-section">
            <label class="form-label">åå¤„ç†æ­£åˆ™è§„åˆ™ (JSON)</label>
            <textarea id="postprocessing-rules" class="form-textarea" rows="4"
              placeholder='æ¸…æ´—æ­£æ–‡å†…å®¹çš„æ­£åˆ™ï¼Œä¾‹å¦‚ï¼š[{"pattern": "...", "replacement": ""}]'></textarea>
            <div class="small-text muted" style="margin-top:4px">ç”¨äºåœ¨æ˜¾ç¤ºå‰æ¸…ç† LLM è¾“å‡ºçš„å¤šä½™ç¬¦å·ã€‚</div>
        </div>
      </div>

      <div id="tab-memory" class="tab-pane">
        <h2 class="section-title">è‡ªåŠ¨æ‘˜è¦ä¸ RAG</h2>
        <div class="settings-section">
          <label class="form-check">
            <input type="checkbox" id="summary-enabled">
            <span>å¯ç”¨è‡ªåŠ¨å‰§æƒ…æ‘˜è¦</span>
          </label>
          <div class="small-text muted" style="margin-left: 22px;">ç³»ç»Ÿå°†åœ¨è¾¾åˆ°ä¸€å®šå­—æ•°åè‡ªåŠ¨è°ƒç”¨ LLM æ€»ç»“å‰§æƒ…ã€‚</div>
        </div>

        <div class="half-grid">
            <div class="settings-section">
                <label class="form-label">æ‘˜è¦ Profile ID</label>
                <input id="summary-profile-id" class="form-input" placeholder="å¦‚ï¼šsummary_v1">
            </div>
            <div class="settings-section">
                <label class="form-label">è§¦å‘é¢‘ç‡ (æ¯ N æ®µå¯¹è¯)</label>
                <input id="summary-frequency" class="form-input" type="number" min="1" value="1">
            </div>
        </div>

        <div class="settings-section">
          <label class="form-label">å†å²è®°å¿†æ£€ç´¢ç­–ç•¥ (RAG Config JSON)</label>
          <textarea id="summary-rag-config" class="form-textarea" rows="6" placeholder='ä¾‹å¦‚ï¼š
              {
                "scene_top_k": 3,
                "chapter_top_k": 1,
                "use_raw_segments": true
              }'></textarea>
        </div>
      </div>

      <div id="tab-variables" class="tab-pane">
        <h2 class="section-title">æ•°å€¼æ€è€ƒä¸æ•°æ®ä¸€è‡´æ€§</h2>
        <div class="settings-section">
            <label class="form-check">
              <input type="checkbox" id="variables-enabled">
              <span>å¯ç”¨å˜é‡è¿½è¸ª (Variable Tracking)</span>
            </label>
        </div>

        <div class="half-grid">
            <div class="settings-section">
                <label class="form-label">å˜é‡æ€è€ƒ Profile ID</label>
                <input id="variables-profile-id" class="form-input" placeholder="ç”¨äºåˆ†ææ•°å€¼å˜åŒ–çš„ Prompt">
            </div>
            <div class="settings-section">
                <label class="form-label">ç‹¬ç«‹ API Config ID</label>
                <input id="variables-api-config-id" class="form-input" placeholder="å»ºè®®ä½¿ç”¨å»‰ä»·é«˜é€Ÿæ¨¡å‹">
            </div>
        </div>

        <div class="settings-section" style="margin-top: 20px; border-top: 1px solid var(--border-soft); padding-top: 15px;">
            <label class="form-check">
              <input type="checkbox" id="alignment-strict">
              <span>å¯ç”¨ä¸¥æ ¼å¯¹é½æ£€æŸ¥ (Strict Alignment)</span>
            </label>
            <div class="small-text muted" style="margin-left: 22px;">é˜²æ­¢ç”Ÿæˆçš„æ•°å€¼è¶…å‡ºè§’è‰²æ¨¡æ¿å®šä¹‰çš„èŒƒå›´ã€‚</div>
        </div>
        <div class="settings-section">
            <label class="form-label">å¯¹é½è§„åˆ™ ID</label>
            <input id="alignment-rule-id" class="form-input" placeholder="å¦‚ï¼šdefault_alignment">
        </div>
      </div>

      <div id="tab-evolution" class="tab-pane">
        <h2 class="section-title">æ–‡æœ¬ä¼˜åŒ–ä¸ä¸–ç•Œæ¼”åŒ–</h2>

        <div class="settings-section">
            <label class="form-check">
              <input type="checkbox" id="textopt-enabled">
              <span>å¯ç”¨æ–‡ç¬”æ¶¦è‰² (Text Polishing)</span>
            </label>
            <div class="settings-section" style="margin-top:8px">
                <label class="form-label">æ¶¦è‰² Profile ID</label>
                <input id="textopt-profile-id" class="form-input" placeholder="å¦‚ï¼štext_opt_v1">
            </div>
        </div>

        <div class="settings-section" style="margin-top: 20px;">
            <label class="form-check">
              <input type="checkbox" id="world-evolution-enabled">
              <span>å¯ç”¨ä¸–ç•ŒåŠ¨æ€æ¼”åŒ– (World Evolution)</span>
            </label>
            <div class="small-text muted" style="margin-left: 22px;">å…è®¸ NPC åœ¨ç©å®¶ä¸åœ¨åœºæ—¶æ ¹æ®ä¸–ç•Œä¹¦è§„åˆ™å‘ç”ŸçŠ¶æ€å˜æ›´ã€‚</div>
            <div class="settings-section" style="margin-top:8px">
                <label class="form-label">æ¼”åŒ–é€»è¾‘ Profile ID</label>
                <input id="world-evolution-profile-id" class="form-input" placeholder="å¦‚ï¼šworld_evolution_v1">
            </div>
        </div>
        <div>
            <label class="form-label">Global Default Profiles (JSON)</label>
            <textarea id="default-profiles" class="form-textarea" rows="12" placeholder='{
                "story_generation": "story_gen_v2",
                "npc_chat": "npc_chat_standard",
                "dungeon_master": "dm_hardcore",
                "summary": "summary_fast",
                "variable_thinking": "math_solver"
              }'></textarea>
        </div>
      </div>

      <div id="tab-presets" class="tab-pane tab-pane-presets">
        <div style="height: calc(100vh - 100px); display: flex; flex-direction: column; overflow: hidden;">

            <div style="flex: 0 0 auto; margin-bottom: 12px; display:flex; justify-content:space-between; align-items:flex-end;">
              <div>
                <h2 class="section-title" style="margin-bottom:4px;">é¢„è®¾ç®¡ç†</h2>
<!--                <div class="small-text muted">æ¨¡å—åŒ–æç¤ºè¯æ ‘ã€‚å·¦ä¾§ç®¡ç†æ–‡ä»¶ï¼Œä¸­é—´è°ƒæ•´ç»“æ„ï¼Œå³ä¾§ç¼–è¾‘å†…å®¹ã€‚</div>-->
              </div>
            </div>

            <div style="flex: 1; display:grid; grid-template-columns: 240px 300px 1fr; gap:12px; min-height: 0;">

              <div class="panel" style="display:flex; flex-direction:column; gap: 14px; padding: 16px; overflow-y: auto;">

                <div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
                        <span class="panel-title" style="font-size:14px;">é¢„è®¾æ–‡ä»¶</span>
                        <button id="preset-create-btn" class="icon-button" title="æ–°å»ºç©ºç™½é¢„è®¾" style="width:24px; height:24px; font-weight:bold;">ï¼‹</button>
                    </div>

                    <select id="preset-select" class="form-select" style="width:100%; cursor:pointer; padding: 6px 10px;"></select>

                    <div style="margin-top:8px; background:rgba(0,0,0,0.1); border-radius:4px; padding:6px 8px; border:1px solid var(--border-soft);">
                        <div class="small-text muted" style="font-size:11px;">å½“å‰åº”ç”¨ ID:</div>
                        <div id="preset-active-hint" class="small-text" style="color:var(--accent); font-family:monospace; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">-</div>
                    </div>
                </div>

                <div style="display:flex; flex-direction:column; gap:8px;">
                    <button id="preset-set-active-btn" class="btn-primary btn-small" style="width:100%; justify-content:center;">â˜… åº”ç”¨ä¸ºå½“å‰é¢„è®¾</button>
                    <div style="display:flex; gap:8px;">
                        <button id="preset-save-btn" class="btn-secondary btn-small" style="flex:1;">ä¿å­˜</button>
                        <button id="preset-delete-btn" class="btn-danger btn-small" style="flex:1;">åˆ é™¤</button>
                    </div>
                </div>

                <div style="height:1px; background:var(--border-soft); margin: 0 4px;"></div>

                <div>
                    <div class="panel-title" style="font-size:13px; margin-bottom:8px; opacity:0.8;">å¯¼å…¥ / å¯¼å‡º</div>

                    <div style="display:flex; flex-direction:column; gap:8px;">
                        <input id="preset-import-name" class="form-input" placeholder="é‡å‘½å (å¯é€‰)" style="font-size:12px; padding:4px 8px;" />

                        <div style="display:flex; gap:6px;">
                             <label class="btn-secondary btn-small" style="flex:1; text-align:center; cursor:pointer; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; display:flex; align-items:center; justify-content:center;">
                                ğŸ“‚ é€‰æ–‡ä»¶
                                <input id="preset-import-file" type="file" accept=".json" style="display:none;" onchange="this.parentElement.style.borderColor = 'var(--accent)';" />
                             </label>
                             <button id="preset-import-btn" class="btn-secondary btn-small" style="flex:0 0 auto;">å¯¼å…¥</button>
                        </div>

                        <button id="preset-export-btn" class="btn-secondary btn-small" style="width:100%;">ğŸ“¤ å¯¼å‡ºå½“å‰ JSON</button>
                    </div>
                </div>

              </div>

              <div class="panel" style="display:flex; flex-direction:column; overflow:hidden; padding: 12px;">
                <div class="panel-header" style="margin-bottom: 8px; flex: 0 0 auto;">
                  <div class="panel-title" style="font-size:14px;">ç»“æ„æ ‘</div>
                  <div style="display:flex; gap:4px;">
                       <button id="preset-add-group-btn" class="icon-button" title="æ·»åŠ ç»„">ğŸ“+</button>
                       <button id="preset-add-prompt-btn" class="icon-button" title="æ·»åŠ æç¤ºè¯">ğŸ“+</button>
                       <button id="preset-delete-node-btn" class="icon-button" style="color:var(--danger); border-color:var(--danger);" title="åˆ é™¤èŠ‚ç‚¹">Ã—</button>
                  </div>
                </div>

                <div id="preset-tree" style="flex: 1; overflow-y: auto; overflow-x: hidden; border: 1px solid var(--border-soft); border-radius: 4px; padding: 4px; background: rgba(0,0,0,0.1);">
                   <div style="text-align:center; padding:20px; color:var(--text-secondary); font-size:12px;">åŠ è½½ä¸­...</div>
                </div>

                <div class="small-text muted" style="margin-top:6px; font-size:11px; flex: 0 0 auto; text-align:center;">
                   æç¤ºï¼šæ‹–æ‹½åŠŸèƒ½å¼€å‘ä¸­
                </div>
              </div>

              <div class="panel" style="display:flex; flex-direction:column; overflow:hidden; padding: 0;">

                <div style="padding: 12px 16px; border-bottom: 1px solid var(--border-soft); background: var(--bg-elevated-alt); display:flex; justify-content:space-between; align-items:center; flex: 0 0 auto;">
                  <div class="panel-title" style="font-size:14px;">èŠ‚ç‚¹å±æ€§</div>
                  <div style="display:flex; align-items:center; gap:8px;">
                      <span class="small-text muted">å¯ç”¨</span>
                      <label class="toggle-switch" title="å¯ç”¨/ç¦ç”¨æ­¤èŠ‚ç‚¹" style="transform:scale(0.8);">
                          <input type="checkbox" id="preset-node-enabled">
                          <span class="slider"></span>
                      </label>
                  </div>
                </div>

                <div id="preset-node-editor-container" style="display:none; flex: 1; flex-direction: column; overflow: hidden;">

                    <div style="padding: 12px 16px; display:grid; grid-template-columns: 1fr 1fr; gap:12px; border-bottom:1px solid var(--border-soft); flex: 0 0 auto;">
                       <div>
                          <label class="form-label small-text muted">æ˜¾ç¤ºåç§° (Name)</label>
                          <input id="preset-node-title" class="form-input" style="padding:4px 8px;" placeholder="èŠ‚ç‚¹åç§°" />
                       </div>
                       <div>
                          <label class="form-label small-text muted">å”¯ä¸€æ ‡è¯† (Identifier)</label>
                          <input id="preset-node-identifier" class="form-input" style="padding:4px 8px; font-family:monospace; color:var(--accent);" placeholder="Unique ID" />
                       </div>
                    </div>

                    <div id="preset-node-prompt-fields" style="display:none; flex: 1; flex-direction: column; min-height: 0;">

                       <div style="flex: 1; display:flex; flex-direction:column; padding: 12px 16px; min-height: 0;">
                           <div style="display:flex; justify-content:space-between; margin-bottom:6px; flex: 0 0 auto;">
                              <label class="form-label small-text" style="font-weight:600;">æç¤ºè¯å†…å®¹ (Content)</label>
                              <span class="small-text muted" style="opacity:0.6; font-size:11px;">æ”¯æŒ Handlebars è¯­æ³•</span>
                           </div>

                           <textarea id="preset-node-content" class="form-textarea"
                              style="flex:1; resize:none; font-family:'JetBrains Mono', monospace; font-size:13px; line-height:1.6; border-color:var(--border-soft); overflow-y: auto; padding:10px;"
                              placeholder="åœ¨è¿™é‡Œè¾“å…¥æç¤ºè¯å†…å®¹..."></textarea>
                       </div>

                       <div style="flex: 0 0 auto; padding: 12px 16px; background: rgba(0,0,0,0.02); border-top: 1px solid var(--border-soft);">

                          <div style="display:grid; grid-template-columns: 1.2fr 1.2fr 0.8fr 0.8fr; gap:10px; align-items:center; margin-bottom:12px;">
                              <div>
                                  <label class="form-label small-text muted" style="margin-bottom:2px;">è§’è‰² (Role)</label>
                                  <select id="preset-node-role" class="form-select" style="padding:4px; height:30px;">
                                    <option value="system">system</option>
                                    <option value="user">user</option>
                                    <option value="assistant">assistant</option>
                                  </select>
                              </div>
                              <div>
                                  <label class="form-label small-text muted" style="margin-bottom:2px;">ä½ç½® (Pos)</label>
                                  <select id="preset-node-position" class="form-select" style="padding:4px; height:30px;">
                                      <option value="0">Top (Head)</option>
                                      <option value="1">User (After)</option>
                                      <option value="-1">Bottom (Tail)</option>
                                  </select>
                              </div>
                              <div>
                                  <label class="form-label small-text muted" style="margin-bottom:2px;" title="æ³¨å…¥é¡ºåº">Order</label>
                                  <input type="number" id="preset-node-order" class="form-input" style="padding:4px; height:30px; text-align:center;" />
                              </div>
                              <div>
                                  <label class="form-label small-text muted" style="margin-bottom:2px;" title="é€’å½’æ·±åº¦">Depth</label>
                                  <input type="number" id="preset-node-depth" class="form-input" style="padding:4px; height:30px; text-align:center;" />
                              </div>
                          </div>

                          <div style="display:flex; justify-content:space-between; align-items:center;">
                              <div style="display:flex; gap:16px;">
                                   <label class="small-text" style="display:flex; align-items:center; gap:6px; cursor:pointer;" title="ä½œä¸º System Prompt å‘é€">
                                      <input type="checkbox" id="preset-node-system-prompt"> System
                                   </label>
                                   <label class="small-text" style="display:flex; align-items:center; gap:6px; cursor:pointer;" title="æ ‡è®°èŠ‚ç‚¹ï¼Œä¸ç›´æ¥å‚ä¸ç”Ÿæˆ">
                                      <input type="checkbox" id="preset-node-marker"> Marker
                                   </label>
                                   <label class="small-text" style="display:flex; align-items:center; gap:6px; cursor:pointer;" title="ç¦æ­¢è¢«å­èŠ‚ç‚¹è¦†ç›–">
                                      <input type="checkbox" id="preset-node-overrides"> Lock
                                   </label>
                              </div>
                              <div style="flex:1; margin-left:20px;">
                                  <input id="preset-node-triggers" class="form-input" style="padding:4px 8px; height:28px; font-size:11px;" placeholder="è§¦å‘å…³é”®è¯ (å¯é€‰, é€—å·åˆ†éš”)" />
                              </div>
                          </div>

                       </div>
                    </div>

                    <div id="prompt-bool-fields" style="display:none; flex:1; flex-direction:column; justify-content:center; align-items:center; text-align:center; color:var(--text-secondary);">
                       <div style="font-size:48px; opacity:0.1; margin-bottom:15px;">ğŸ“</div>
                       <div style="font-size:14px; font-weight:600;">åˆ†ç»„èŠ‚ç‚¹</div>
                       <div class="small-text muted" style="margin-top:6px;">åŒ…å«å­èŠ‚ç‚¹ï¼Œè‡ªèº«ä¸å­˜å‚¨æç¤ºè¯å†…å®¹ã€‚</div>
                    </div>

                </div>

                <div id="preset-node-hint" style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; color:var(--text-secondary); opacity:0.6;">
                    <div style="font-size:56px; margin-bottom:15px; opacity:0.5;">ğŸ‘ˆ</div>
                    <div style="font-size:15px;">è¯·åœ¨ä¸­é—´æ é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹</div>
                    <div class="small-text muted">ä»¥æŸ¥çœ‹æˆ–ç¼–è¾‘è¯¦ç»†å±æ€§</div>
                </div>

              </div>
            </div>
        </div>
      </div>

      <div id="tab-api" class="tab-pane">
        <h2 class="section-title">APIé…ç½®ï¼ˆå¤§æ¨¡å‹ï¼‰</h2>
        <div class="small-text muted" style="margin-bottom: 12px;">
          æ”¯æŒå¤šä¸ª OpenAI å…¼å®¹æ¥å£ï¼šå¡«å†™ base_url ä¸ api_key åï¼Œå¯æ£€ç´¢å¯ç”¨æ¨¡å‹ï¼›å¹¶æ”¯æŒæµå¼è¾“å‡ºå¼€å…³ã€‚
        </div>

        <div class="settings-section" style="display:grid;grid-template-columns: 280px 1fr;gap:14px;align-items:start;">
          <div class="panel">
            <div class="panel-header">
              <div>
                <div class="panel-title">é…ç½®åˆ—è¡¨</div>
                <div class="panel-subtitle" id="llm-active-hint">å½“å‰ï¼š-</div>
              </div>
              <div class="panel-header-right">
                <button id="llm-new-btn" class="btn-secondary btn-small">æ–°å»º</button>
              </div>
            </div>
            <div id="llm-config-list" class="list"></div>
            <div class="settings-section small-text muted" id="llm-status">å°±ç»ª</div>
          </div>

          <div class="panel">
            <div class="panel-header">
              <div>
                <div class="panel-title">é…ç½®ç¼–è¾‘</div>
                <div class="panel-subtitle">ä¿å­˜åå¯æ£€ç´¢æ¨¡å‹ã€‚</div>
              </div>
              <div class="panel-header-right">
                <button id="llm-set-active-btn" class="btn-primary btn-small">è®¾ä¸ºå½“å‰</button>
                <button id="llm-save-btn" class="btn-secondary btn-small">ä¿å­˜</button>
                <button id="llm-delete-btn" class="btn-danger btn-small">åˆ é™¤</button>
              </div>
            </div>

            <div class="settings-section">
              <label class="form-label">åç§°</label>
              <input id="llm-name" class="form-input" placeholder="ä¾‹å¦‚ï¼šOpenAI / æœ¬åœ° vLLM / Kimi ..." />

              <label class="form-label" style="margin-top:10px;">Base URL</label>
              <input id="llm-base-url" class="form-input" placeholder="https://api.openai.com æˆ– http://localhost:8000" />

              <label class="form-label" style="margin-top:10px;">API Key</label>
              <input id="llm-api-key" class="form-input" placeholder="sk-..." />

              <div class="settings-section" style="margin-top:10px;">
                <label class="form-check">
                  <input type="checkbox" id="llm-stream" checked>
                  <span>å¯ç”¨æµå¼è¾“å‡ºï¼ˆStreamingï¼‰</span>
                </label>
              </div>

              <div class="settings-section" style="display:grid;grid-template-columns: 1fr auto;gap:10px;align-items:end;">
                <div>
                  <label class="form-label">å¯ç”¨æ¨¡å‹</label>
                  <select id="llm-model-select" class="form-select"></select>
                </div>
                <button id="llm-refresh-models-btn" class="btn-secondary btn-small">æ£€ç´¢æ¨¡å‹</button>
              </div>

              <div class="settings-section" style="margin-top:10px;">
                <label class="form-label">é»˜è®¤æ¨¡å‹ï¼ˆå¯é€‰ï¼‰</label>
                <input id="llm-default-model" class="form-input" placeholder="ä¸ºç©ºåˆ™ä½¿ç”¨ä¸Šæ–¹é€‰æ‹©" />
              </div>

              <div class="small-text muted" style="margin-top:10px;">
                è¯´æ˜ï¼šå¦‚æœ base_url å·²åŒ…å« /v1 ä¹Ÿå¯ç›´æ¥å¡«å†™ï¼›ç³»ç»Ÿä¼šè‡ªåŠ¨è¡¥é½ã€‚
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <script src="assets/js/settings.js"></script>
</body>
</html>